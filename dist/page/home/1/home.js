"use strict";define(["module","common/kernel/kernel","common/chart/chart"],function(e,t,n){var s=e.id.replace(/^[^/]+\/|\/[^/]+/g,""),a=document.querySelector("#page>."+s),r=new n(a.querySelector(".chart")),o=a.querySelector(".list"),l="https://trade.tinysoft.com.cn/webapi/api2.tsl";return r.paddingLeft=60,o.addEventListener("keydown",function(e){var t;38!==e.keyCode&&40!==e.keyCode||(e.preventDefault(),r.selected&&(t=o.querySelector('a[data-id="'.concat(r.selected,'"]'))),(t=t?38===e.keyCode?t===o.firstChild?o.lastChild:t.previousSibling:t===o.lastChild?o.firstChild:t.nextSibling:o.firstChild)&&(t.scrollIntoView(),t.click()))}),o.addEventListener("click",function(e){if("A"===e.target.nodeName)if(r.selected===e.target.dataset.id)r.selected=undefined,e.target.style.fontWeight="";else{var t=o.querySelector('a[data-id="'.concat(r.selected,'"]'));t&&(t.style.fontWeight=""),e.target.style.fontWeight="bold",r.selected=e.target.dataset.id}}),{onload:function(){t.showLoading(),Promise.all([fetch(l,{method:"post",body:"ServiceID=Z002"}).then(function(e){return e.json()}),fetch(l,{method:"post",body:"ServiceID=Z003&param=["+encodeURIComponent('"Aè‚¡"')+"]"}).then(function(e){return e.json()}).then(function(e){var t=e.Result;return caches.open("chart").then(function(e){return e.match("/data").then(function(e){return e?e.json().then(function(e){return fetch(l,{method:"post",body:'ServiceID=Z001&param=["'+Object.keys(t).join(";")+'",'+e.days[e.days.length-1]+"]"}).then(function(e){return e.json()}).then(function(n){for(var s=1;s<n.Result.length;s++){s>1&&e.days.push(n.Result[s][0]);for(var a=1;a<n.Result[s].length;a++)null!==n.Result[s][a]&&(e.base[n.Result[0][a]]||(e.base[n.Result[0][a]]=[t[n.Result[0][a]],e.days.length-1]),1===s&&e.base[n.Result[0][a]].length>2?e.base[n.Result[0][a]].splice(-1,1,n.Result[s][a]):e.base[n.Result[0][a]].push(n.Result[s][a]))}return e})}):fetch(l,{method:"post",body:'ServiceID=Z001&param=["'+Object.keys(t).join(";")+'"]'}).then(function(e){return e.json()}).then(function(e){for(var n={days:[],base:{}},s=1;s<e.Result.length;s++){for(var a=1;a<e.Result[s].length;a++)null!==e.Result[s][a]&&(n.base[e.Result[0][a]]||(n.base[e.Result[0][a]]=[t[e.Result[0][a]],n.days.length]),n.base[e.Result[0][a]].push(e.Result[s][a]));n.days.push(e.Result[s][0])}return n})}).then(function(t){return e.put("/data",new Response(JSON.stringify(t))),t})})})]).then(function(e){var n=e[0].Result,s=e[1],a={},l={},c={},u={0:[.25,.75,.25],1:[.25,.25,.25],2:[.75,.25,.25]};for(var i in n){if(s.base[i]){var d=s.days.indexOf(n[i][0]);if(d>=0){c[i]=[],a[i]={data:[],cursor:d-s.base[i][1]},l[i]={starts:[],colors:[]};for(var h=2;h<s.base[i].length;h++)c[i][0]!==s.base[i][h][3]&&(c[i][0]=s.base[i][h][3],l[i].starts.push(a[i].data.length),l[i].colors.push(u[s.base[i][h][3]])),c[i][1]=s.base[i][h][2],a[i].data.push(s.base[i][h][0]*s.base[i][h][1])}}s.base[i]=s.base[i][0]}r.add(a),r.setSections(l),r.center();for(var f=Object.keys(c).sort(function(e,t){return c[t][1]-c[e][1]}),p="",b=0;b<f.length;b++)p+='<a data-id="'.concat(f[b],'"><span class="name">').concat(s.base[f[b]],'</span><span class="progress c').concat(c[f[b]][0],'"><span style="width: ').concat(100*c[f[b]][1],'%"></span></span></a>');o.innerHTML=p,t.hideLoading()})}}});