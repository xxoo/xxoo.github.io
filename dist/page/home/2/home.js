"use strict";define(["module","common/kernel/kernel","common/chart/chart"],function(e,t,n){var s=e.id.replace(/^[^/]+\/|\/[^/]+/g,""),a=document.querySelector("#page>."+s),r=new n(a.querySelector(".chart")),o=a.querySelector(".list"),l="https://trade.tinysoft.com.cn/webapi/api2.tsl";return r.paddingLeft=60,o.addEventListener("keydown",function(e){var t;38!==e.keyCode&&40!==e.keyCode||(e.preventDefault(),r.selected&&(t=o.querySelector('a[data-id="'.concat(r.selected,'"]'))),(t=t?38===e.keyCode?t===o.firstChild?o.lastChild:t.previousSibling:t===o.lastChild?o.firstChild:t.nextSibling:o.firstChild)&&(t.scrollIntoView(),t.click()))}),o.addEventListener("click",function(e){if("A"===e.target.nodeName)if(r.selected===e.target.dataset.id)r.selected=undefined,e.target.style.fontWeight="";else{var t=o.querySelector('a[data-id="'.concat(r.selected,'"]'));t&&(t.style.fontWeight=""),e.target.style.fontWeight="bold",r.selected=e.target.dataset.id}}),{onload:function(){t.showLoading(),Promise.all([fetch(l,{method:"post",body:"ServiceID=Z002"}).then(function(e){return e.json()}),fetch(l,{method:"post",body:"ServiceID=Z003&param=["+encodeURIComponent('"Aè‚¡"')+"]"}).then(function(e){return e.json()}).then(function(e){var t=e.Result;return caches.open("chart").then(function(e){return e.match("/data").then(function(n){return n?n.json().then(function(n){return fetch(l,{method:"post",body:'ServiceID=Z001&param=["'+Object.keys(t).join(";")+'",'+n.days[n.days.length-1]+"]"}).then(function(e){return e.json()}).then(function(s){for(var a=1;a<s.Result.length;a++){a>1&&n.days.push(s.Result[a][0]);for(var r=1;r<s.Result[a].length;r++)null!==s.Result[a][r]&&(n.base[s.Result[0][r]]||(n.base[s.Result[0][r]]=[t[s.Result[0][r]],n.days.length-1]),1===a&&n.base[s.Result[0][r]].length>2?n.base[s.Result[0][r]].splice(-1,1,s.Result[a][r]):n.base[s.Result[0][r]].push(s.Result[a][r]))}return s.Result.length>2&&e.put("/data",new Response(JSON.stringify(n))),n})}):fetch(l,{method:"post",body:'ServiceID=Z001&param=["'+Object.keys(t).join(";")+'"]'}).then(function(e){return e.json()}).then(function(n){for(var s={days:[],base:{}},a=1;a<n.Result.length;a++){for(var r=1;r<n.Result[a].length;r++)null!==n.Result[a][r]&&(s.base[n.Result[0][r]]||(s.base[n.Result[0][r]]=[t[n.Result[0][r]],s.days.length]),s.base[n.Result[0][r]].push(n.Result[a][r]));s.days.push(n.Result[a][0])}return e.put("/data",new Response(JSON.stringify(s))),s})})})})]).then(function(e){var n=e[0].Result,s=e[1],a={},l={},c={},i=[[.25,.75,.25],[.25,.25,.25],[.75,.25,.25]];for(var u in n){if(s.base[u]){var d=s.days.indexOf(n[u][0]);if(d>=0){c[u]=[],a[u]={data:[],cross:d-s.base[u][1]},l[u]={starts:[],colors:[]};for(var h=2;h<s.base[u].length;h++)c[u][0]!==s.base[u][h][3]&&(c[u][0]=s.base[u][h][3],l[u].starts.push(a[u].data.length),l[u].colors.push(i[s.base[u][h][3]])),c[u][1]=s.base[u][h][2],a[u].data.push(s.base[u][h][0]*s.base[u][h][1])}}s.base[u]=s.base[u][0]}r.add(a),r.setSections(l),r.center();for(var f=Object.keys(c).sort(function(e,t){return c[t][1]-c[e][1]}),p="",b=0;b<f.length;b++)p+='<a data-id="'.concat(f[b],'"><span class="name">').concat(s.base[f[b]],'</span><span class="progress c').concat(c[f[b]][0],'"><span style="width: ').concat(100*c[f[b]][1],'%"></span></span></a>');o.innerHTML=p,t.hideLoading()})}}});