"use strict";function _typeof(n){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(n,t,e,o,i){var s,a,r,c,d,u,l,p,f,h,y={appendCss:function(n,t){var e=document.createElement("link");return"object"!==("undefined"==typeof less?"undefined":_typeof(less))||t?(e.rel="stylesheet",e.href=n+".css"):(e.rel="stylesheet/less",e.href=n+".less",less.sheets.push(e),less.refresh()),(document.head||document.getElementsByTagName("head")[0]).appendChild(e)},removeCss:function(n){$(n).remove(),"stylesheet/less"===n.rel&&(less.sheets.splice(less.sheets.indexOf(n),1),less.refresh())},buildHash:function(n){var t,e="#!"+encodeURIComponent(n.id);for(t in n.args)e+=n.args[t]===undefined?"&"+encodeURIComponent(t):"&"+encodeURIComponent(t)+"="+encodeURIComponent(n.args[t]);return e},parseHash:function(n){var e,o,i,a={id:s,args:{}};if((i=(n=n.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g))&&"!"===i[0].charAt(0))for(o=decodeURIComponent(i[0].substr(1)),t.hasOwnProperty(o)&&(a.id=o),e=1;e<i.length;e++)(o=i[e].match(/^([^=]+)(=)?(.+)?$/))&&(a.args[decodeURIComponent(o[1])]=o[2]?decodeURIComponent(o[3]||""):undefined);return a},isSameLocation:function(n,t){var e;if(n.id===t.id&&Object.keys(n.args).length===Object.keys(t.args).length){for(e in n.args){if(!t.args.hasOwnProperty(e))return!1;if(n.args[e]===undefined){if(n.args[e]!==t.args[e])return!1}else if(""+n.args[e]!=""+t.args[e])return!1}return!0}return!1},replaceLocation:function(n){y.location&&y.isSameLocation(n,y.location)?y.reloadPage():location.replace(y.buildHash(n))},getLang:function(n){var t;if(navigator.languages){for(t=0;t<navigator.languages.length;t++)if(n.hasOwnProperty(navigator.languages[t]))return n[navigator.languages[t]]}else if(n.hasOwnProperty(navigator.language))return n[navigator.language];return n.en}};return i=y.getLang(i),function(){var n="function"==typeof Symbol?Symbol("xEvents"):"xEvents";function t(t){var o;for(this[n][t.type].locked=!0,o=0;o<this[n][t.type].heap.length;o++)this[n][t.type].heap[o].call(this,t);for(this[n][t.type].locked=!1;this[n][t.type].stack.length;)this[n][t.type].stack[0]?"function"==typeof this[n][t.type].stack[0]?(o=this[n][t.type].heap.indexOf(this[n][t.type].stack[0]))>=0&&this[n][t.type].heap.splice(o,1):this[n][t.type].heap.indexOf(this[n][t.type].stack[0][0])<0&&this[n][t.type].heap.push(this[n][t.type].stack[0][0]):this[n][t.type].heap.splice(0),this[n][t.type].stack.shift();e(this,t.type)}function e(t,e,o){!o&&t[n][e].heap.length||(delete t[n][e],t["on"+e]=null)}y.listeners={add:function(e,o,i){var s=0;return"function"==typeof i&&(e.hasOwnProperty(n)||(e[n]={}),e[n].hasOwnProperty(o)||(e[n][o]={stack:[],heap:[],locked:!1},e["on"+o]=t),e[n][o].locked?(e[n][o].stack.push([i]),s=2):e[n][o].heap.indexOf(i)<0&&(e[n][o].heap.push(i),s=1)),s},list:function(t,e){var o,i;if(e)i=t.hasOwnProperty(n)&&t[n].hasOwnProperty(e)?t[n][e].heap.slice(0):[];else if(i={},t.hasOwnProperty(n))for(o in t[n])i[o]=t[n][o].heap.slice(0);return i},remove:function(t,o,i){var s,a=0;if(t.hasOwnProperty(n))if(o)t[n].hasOwnProperty(o)&&(t[n][o].locked?(t[n][o].stack.push(i),a=2):"function"==typeof i?(s=t[n][o].heap.indexOf(i))>=0&&(t[n][o].heap.splice(s,1),e(t,o),a=1):(e(t,o,!0),a=1));else{for(s in t[n])t[n][s].locked?(t[n][s].stack.push(undefined),a=2):e(t,s,!0);a||(a=1)}return a}}}(),function(){var n,t,e,i=$("#panel"),s=i.find(">.contents>div");function a(n,o){t=!0,s.animate({"margin-left":o?"-100%":"0%"},{duration:200,complete:function(){var o;t=!1,n(),"function"==typeof e&&(o=e,e=undefined,o())}})}function r(){if("function"!=typeof o[n].onunload||!o[n].onunload())return o[n].status--,a(function(){"function"==typeof o[n].onunloadend&&o[n].onunloadend(),o[n].status--,s.find(">."+n)[0].style.display=i[0].style.display="",o[n].autoDestroy&&g(o[n],"panel",n),n=undefined},!1),!0}y.openPanel=function(n,t){if(o.hasOwnProperty(n))return m("panel",o[n],n,function(){"function"==typeof o[n].open?o[n].open(t):y.showPanel(n)}),!0},y.showPanel=function(c){var d=0;return o[c].status>1&&(t?(e=y.showPanel.bind(this,c),d=2):n?n===c?("function"==typeof o[c].onload&&o[c].onload(),"function"==typeof o[c].onloadend&&o[c].onloadend(),d=1):r()&&(e=y.showPanel.bind(this,c),d=1):(o[c].status++,"function"==typeof o[c].onload&&o[c].onload(),i[0].className=n=c,i[0].style.display=s.find(">."+c)[0].style.display="block",a(function(){"function"==typeof o[c].onloadend&&o[c].onloadend(),o[c].status++},!0),d=1)),d},y.closePanel=function(o){var i=0;return t?(e=y.closePanel.bind(this,o),i=2):n&&(!o||n===o||"Array"===dataType(o)&&o.indexOf(n)>=0)&&r()&&(i=1),i},y.getCurrentPanel=function(){return n},y.destroyPanel=function(n){if(2===o[n].status)return g(o[n],"panel",n),!0},e=y.closePanel.bind(y,undefined),s.find(">.close").on("click",e),i.find(">.mask").on("click",e),e=undefined}(),function(){var n,t=document.getElementById("popup"),o=$(t).find(">div>div");y.openPopup=function(n,t){if(e.hasOwnProperty(n))return m("popup",e[n],n,function(){"function"==typeof e[n].open?e[n].open(t):y.showPopup(n)}),!0},y.showPopup=function(i){var s;return e[i].status>1&&(n?n===i?("function"==typeof e[i].onload&&e[i].onload(),s=!0):"function"==typeof e[n].onunload&&e[n].onunload()||(e[n].status--,o.find(">."+n).css("display",""),e[n].autoDestroy&&g(e[n],"popup",n),o.find(">."+i).css("display","block"),t.className=n=i,e[i].status++,"function"==typeof e[i].onload&&e[i].onload(),s=!0):(o.find(">."+i)[0].style.display=t.style.display="block",t.className=n=i,"function"==typeof y.popupEvents.onshow&&y.popupEvents.onshow({type:"show",id:n}),e[i].status++,"function"==typeof e[i].onload&&e[i].onload(),s=!0)),s},y.closePopup=function(i){var s;if(n&&(!i||n===i||"Array"===dataType(i)&&i.indexOf(n)>=0)&&("function"!=typeof e[n].onunload||!e[n].onunload()))return e[n].status--,s=n,o.find(">."+n)[0].style.display=t.style.display=t.className=n="",e[s].autoDestroy&&g(e[s],"popup",n),"function"==typeof y.popupEvents.onhide&&y.popupEvents.onhide({type:"hide",id:s}),!0},y.getCurrentPopup=function(){return n},y.destroyPopup=function(n){if(2===e[n].status)return g(e[n],"popup",n),!0},y.popupEvents={},$(t).find(">div>a").on("click",y.closePopup.bind(y,undefined))}(),function(){var t,e,o=$("#photoview"),i=o.find(".close"),s=o.find(".prev"),a=o.find(".next"),r=o.find(".rotate.p"),c=o.find(".rotate.n"),d=n(o.find(">div")),u=[],l=[];function p(){var n=$(self);t=n.innerWidth(),e=n.innerHeight(),"number"==typeof d.current&&u[d.current]&&h(d.current)}function f(n){d.children[n].one("load",function(){u[n]={w:this.width,h:this.height},l[n]=0,d.current===n&&h(n),this.style.visibility="visible"})}function h(n){var o,i,s,a,r,c=l[n]%2;c?(a=u[n].h,r=u[n].w):(a=u[n].w,r=u[n].h),a>t||r>e?(t/e>(o=a/r)?i=(s=e)*o:s=(i=t)/o,c?(a=s,r=i):(a=i,r=s),d.children[n].css("cursor","zoom-in")):(a=u[n].w,r=u[n].h,d.children[n].css("cursor","")),d.children[n].css({top:(e-r)/2+"px",left:(t-a)/2+"px",width:a+"px",height:r+"px",transform:"rotate("+90*l[n]+"deg)"})}y.showPhotoView=function(n,t){var e;if("Array"===dataType(n)){for(e=0;e<n.length;e++)d.add($('<img src="'+n[e]+'"/>')),f(e);t>=0&&t<d.children.length&&d.slideTo(t,!0),d.children.length>1?(s.css("display","block"),a.css("display","block")):(s.css("display",""),a.css("display",""))}},y.hidePhotoView=function(){for(u=[];d.children.length;)d.remove(0)},o.on("click",">div>img",function(){"zoom-in"===this.style.cursor?(l[d.current]%2?(this.style.top=u[d.current].w>e?(u[d.current].w-u[d.current].h)/2+"px":(e-u[d.current].h)/2+"px",this.style.left=u[d.current].h>t?(u[d.current].h-u[d.current].w)/2+"px":(t-u[d.current].w)/2+"px"):(this.style.top=u[d.current].h>e?0:(e-u[d.current].h)/2+"px",this.style.left=u[d.current].w>t?0:(t-u[d.current].w)/2+"px"),this.style.width=u[d.current].w+"px",this.style.height=u[d.current].h+"px",this.style.cursor="zoom-out"):"zoom-out"===this.style.cursor&&h(d.current)}),$(self).on("resize",p),s.on("click",function(){d.slideTo(d.current-1)}),a.on("click",function(){d.slideTo(d.current+1)}),r.on("click",function(){"number"==typeof l[d.current]&&(l[d.current]++,h(d.current))}),c.on("click",function(){"number"==typeof l[d.current]&&(l[d.current]--,h(d.current))}),i.on("click",y.hidePhotoView),d.onchange=function(){this.current===undefined?o.css("display",""):(u[this.current]&&h(this.current),o.css("display","block"))},"transform"in document.documentElement.style&&(r.css("display","block"),c.css("display","block")),p()}(),d=0,u=$("#hint"),l=$("#readable"),p=$("#dialog"),f=$("#loading"),h=[],y.showLoading=function(n){f.find(">div>div").text(n||i.loading),0===d&&f.css("display","block"),d+=1},y.hideLoading=function(){d>0&&0==(d-=1)&&(f.css("display",""),"function"==typeof y.dialogEvents.onloaded&&y.dialogEvents.onloaded({type:"loaded"}))},y.isLoading=function(){return d>0},y.hint=function(n,t,e){u[0].className=t||"",u.find("span").text(n),a?clearTimeout(a):(u.css("display","block"),u[0].offsetWidth,u.fadeIn()),e||(e="error"===t?4e3:"warning"===t?3e3:2e3),a=setTimeout(function(){a=0,u.fadeOut(function(){u.css("display","")})},e)},y.showReadable=function(n,t,e,o,i){l.prop("className",i||"").css("display","block").find(">div").css({width:t,height:e}).find(">div").append(n),c=o},y.hideReadable=function(){"function"==typeof c&&(c(),c=undefined),l.css("display","").find(">div>div>*").remove()},y.hideDialog=function(n){var t;"function"==typeof r&&(t=r,r=undefined,t("isConfirm"===p[0].className?n:undefined)),p[0].className="",h.length&&(t=h.shift(),y[t.shift()].apply(y,t))},y.showForeign=function(n,t,e,o){y.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+n+'"></iframe>',t,e,o,"foreign")},y.confirm=function(n,t,e){var o,s,a,c;p[0].className?h.push(["confirm",n,t,e]):(s=(o=p.find(">div")).find(">div>div"),a=o.find(">a.yes"),c=o.find(">a.no"),r=t,o.css("width",e||"400px"),"Array"===dataType(n)?(s.text(n[0]),a.text(n[1]),c.text(n[2])):(s.text(n),a.text(i.yes),c.text(i.no)),p[0].className="isConfirm",o.css("height",s.outerHeight()+Math.max(a.outerHeight(),c.outerHeight())+76+"px"))},y.alert=function(n,t,e){var o,i;p[0].className?h.push(["alert",n,t,e]):(i=(o=p.find(">div")).find(">div>div"),r=t,o.css("width",e||"400px"),i.text(n),p[0].className="isAlert",o.css("height",i.outerHeight()+46+"px"))},l.find(">div>a").on("click",y.hideReadable),p.find(">div>a.close").on("click",y.hideDialog),p.find(">div>a.yes").on("click",function(){y.hideDialog(!0)}),p.find(">div>a.no").on("click",function(){y.hideDialog(!1)}),y.dialogEvents={},function(){var n;function e(e,o){(!e||e===n||"Array"===dataType(e)&&e.indexOf(n)>=0)&&(o||w(),"function"==typeof t[n].onload&&t[n].onload(!0))}function o(){var e=history.state,o=y.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),y.location&&y.isSameLocation(y.location,o)||(y.lastLocation=y.location,y.location=o,y.lastLocation&&w(),"function"==typeof y.pageEvents.onroute&&y.pageEvents.onroute({type:"route",history:e}),m("page",t[o.id],o.id,function(i){var s;o.id!==n?(s=i||!e,n&&("function"==typeof t[n].onunload&&t[n].onunload(),t[n].status--,v("page",n).css("display",""),t[n].autoDestroy&&g(t[n],"popup",activePopup)),document.body.className=n=o.id,v("page",o.id).css("display","block"),t[o.id].status++,"function"==typeof t[o.id].onload&&t[o.id].onload(s)):"function"==typeof t[o.id].onload&&t[o.id].onload(),"function"==typeof y.pageEvents.onrouteend&&y.pageEvents.onrouteend({type:"routeend",history:e,force:s})}))}y.init=function(n){var e,i,a;if(t.hasOwnProperty(n))if(s){if(s!==n&&(i=s,s=n,y.location.id===i))return o(),!0}else s=n,"onhashchange"in self?$(self).on("hashchange",o):(setInterval(function(){e!==location.hash&&(e=location.hash,o())},10),e=location.hash),o(),y.location.args.hasOwnProperty("autopopup")&&(y.location.args.hasOwnProperty("autopopuparg")&&(a=y.location.args.autopopuparg.parseJsex())&&(a=a.value),y.openPopup(y.location.args.autopopup,a))},y.reloadPage=function(n,t){var o;y.isLoading()?(o=y.location,y.listeners.add(y.dialogEvents,"loaded",function i(s){y.listeners.remove(this,s.type,i);o===y.location&&e(n,t)})):e(n,t)},y.destroyPage=function(n){if(2===t[n].status)return g(t[n],"page",n),!0},y.pageEvents={}}(),y;function g(n,t,e){var o,i=v(t,e);if(i.length&&("function"==typeof n.ondestroy&&n.ondestroy(),i.remove(),n.js&&(o=t+"/"+e+"/"+e,require.defined(o)&&(i=require(o),require.undef(o),i))))for(o in i)delete n[o];n.css&&n.css.href&&(y.removeCss(n.css),n.css=!0),delete n.status}function v(n,t){var e="#"+n;return"popup"===n?e+=">div>div":"panel"===n&&(e+=">.contents>div"),t&&(e+=">."+t),$(e)}function m(n,t,e,o){var s,a,r,c;function d(i){var s,r=v(n);r[0].insertAdjacentHTML("beforeEnd",'<div class="'+e+'">'+i+"</div>"),t.js?(r[0].lastChild.style.visibility="hidden",y.showLoading(),y.listeners.add(y.dialogEvents,"loaded",function c(n){y.listeners.remove(this,n.type,c);r.find(">."+e)[0].style.visibility=""}),s=a+e,require([s],function(n){n&&Object.assign(t,n),t.status++,o(!0),y.hideLoading()},BUILD&&function(o){g(t,n,e),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?u(s,o.message):l(),y.hideLoading()})):(t.status++,o(!0))}function u(n,t){y.alert(i.error.replace("${res}",n)+t,c?function(){history.back()}:undefined)}function l(){c?location.reload():y.confirm(i.update,function(n){n&&location.reload()})}t.status>1?o():t.status||(t.status=1,a=n+"/"+e+"/",r=require.toUrl(a),c="page"===n,t.css&&(t.css=y.appendCss(r+e)),t.html?(s=r+e+".html",$.ajax({url:s,type:"get",dataType:"text",success:d,error:function(o){g(t,n,e),BUILD&&404===o.status?l():u(s,o.status)},complete:y.hideLoading}),y.showLoading()):d(""))}function w(){y.closePanel(),y.closePopup(),y.hideReadable()}});